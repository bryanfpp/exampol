name: Java CI - JUnit

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Configurar Java 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21

      - name: Crear carpetas de compilación
        run: |
          mkdir -p bin
          mkdir -p testbin

      - name: Compilar código fuente (src/*.java)
        run: javac -d bin src/*.java

      - name: Compilar tests (tests/*.java)
        run: javac -cp "bin:lib/junit-platform-console-standalone-1.9.3.jar" -d testbin tests/*.java

      - name: Ejecutar tests y guardar salida
        run: |
          java -jar lib/junit-platform-console-standalone-1.9.3.jar \
          --class-path "bin:testbin:lib/junit-platform-console-standalone-1.9.3.jar" \
          --scan-class-path > test_output.txt || true

      - name: Ver salida en consola
        run: cat test_output.txt

      - name: Determinar estado de los tests
        id: teststatus
        run: |
          if grep -q "FAILURE" test_output.txt; then
            echo "status=failed" >> $GITHUB_OUTPUT
          else
            echo "status=success" >> $GITHUB_OUTPUT
          fi

      - name: Generar reporte HTML
        run: |
          cp template_reporte.html index.html

          STATUS="${{ steps.teststatus.outputs.status }}"
          AUTHOR="$(git log -1 --pretty=format:'%an')"
          TIMESTAMP="$(git log -1 --pretty=format:'%ad')"
          COMMIT_MESSAGE="$(git log -1 --pretty=format:'%s')"
          COMMIT_COUNT=$(git rev_
